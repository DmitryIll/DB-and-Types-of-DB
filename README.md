# Базы данных, их типы

## Задание 1. СУБД ##
Кейс

Крупная строительная компания, которая также занимается проектированием и девелопментом, решила создать правильную архитектуру для работы с данными. Ниже представлены задачи, которые необходимо решить для каждой предметной области.

Какие типы СУБД, на ваш взгляд, лучше всего подойдут для решения этих задач и почему?

---

1.1. Бюджетирование проектов с дальнейшим формированием финансовых аналитических отчётов и прогнозирования рисков. СУБД должна гарантировать целостность и чёткую структуру данных.

### Ответ 

Использовать реляционную БД, например Postgresql или MS SQL. В реляционной БД можно гарантировать целостность данных и согласованность. 

---

1.1.* Хеширование стало занимать длительно время, какое API можно использовать для ускорения работы?

### Ответ 

Хеширование подсчет хеша? или контрольных сумм? Тогда может их не считать второй раз а использова кэширование? Можно попробовать Redis использовать.

---

1.2. Под каждый девелоперский проект создаётся отдельный лендинг, и все данные по лидам стекаются в CRM к маркетологам и менеджерам по продажам. Какой тип СУБД лучше использовать для лендингов и для CRM? СУБД должны быть гибкими и быстрыми.

### Ответ 

mongodb - быстрая БД для таких задач, гибкая и функциональная. Возможно также можно использовать Elastic search.
Для маркетологов на этапе "стекаются" можно использовать реляционную БД для построения потом отчетов и анализа данных.

---

1.2.* Можно ли эту задачу закрыть одной СУБД? И если да, то какой именно СУБД и какой реализацией?

### Отввет

Предполагаю можно одной mongodb или elastic search.

В mongodb есть и способ получения данных через sql запросы.

---

1.3. Отдел контроля качества решил создать базу по корпоративным нормам и правилам, обучающему материалу и так далее, сформированную согласно структуре компании. СУБД должна иметь простую и понятную структуру.

### Ответ

Использовать документо-ориентированную БД. Mongodb или Elastic search.

----

1.3.* Можно ли под эту задачу использовать уже существующую СУБД из задач выше и если да, то как лучше это реализовать?

### Ответ

В принципе можно и реляционную БД использовать. Просто там видимо чуть сложнее это будет настроить.

---

1.4. Департамент логистики нуждается в решении задач по быстрому формированию маршрутов доставки материалов по объектам и распределению курьеров по маршрутам с доставкой документов. СУБД должна уметь быстро работать со связями.

### Ответ

- Графовую БД использовать.

---

1.4.* Можно ли к этой СУБД подключить отдел закупок или для них лучше сформировать свою СУБД в связке с СУБД логистов?

### Ответ

Для закупок видимо лучше реляционную БД, например PSQL - для подсчета сумм и анализа и для формирования точных отчетов.

--- 

1.5.* Можно ли все перечисленные выше задачи решить, используя одну СУБД? Если да, то какую именно?

### Ответ

В принципе можно везде использовать реляционную БД например psql. Просто некоторые вещи на ней будет сложнее реализовать и сложнее бизнес логику в ПО сделать. И работать будет медленнее.

Приведите ответ в свободной форме.

---

---

## Задание 2. Транзакции

---

2.1. Пользователь пополняет баланс счёта телефона, распишите пошагово, какие действия должны произойти для того, чтобы транзакция завершилась успешно. Ориентируйтесь на шесть действий.

### Ответ

Если тут важен ответ только про ОДНУ транзакцию, то, см.  в п.4 - там одна большая транзакция. Но, считаю часть операций нужно до и после выполнить - отдельно.
В одной транзакции считаю должны выполняться только действия, которые вносят изменнения в БД в разных ее местах, что бы их можно было или все выполнить, или - все откатить.

1. *Запрос в банк* Например пользователь с телефона шлет CMC со своего номера, к которому привязан банк клиент, СМС шлет на номер 900 Сбербкнка в которой указывает номер телефона которому нужно положить на счет денег и сумму.  Получив СМС ПО банка определяет номер телефона с которого пришел запрос и проверяет что такой номер в принципе есть в таблице в БД и ему соответствует мобильный банк и есть счет списания средств и сама команда в CMC корректная. Если все ок идет процесс дальше. 

2. *Аутентификация* - банк проверяет что этот "тот самый клиент" - банк шлет обратно на номер СМС с описанием какая операция будет выполнена и высылает код подтверждения, и просит пользователя отравить обратно этот код. Пользователь отправляет обратно полученный код - подтверждая, что запрос был отправлен изначельно им и он согласен на списание сердств. Т.е. ПО банка генерит код, и записывает ее в БД. Тут можно уже начать общую транзакцию. Но, я бы не стал пока начинать большую транзакцию, а можно пока просто записать значение кода в тбалицу - отдельной транзакцией, т.к. она не влияет существенно. Получив обратно код подтверждения ПО банка проверяет что этот код соответствует тому что ранее был записана в таблицу.

3. Банк проверяет что средства есть на счету, если все ок - банк проверяет что по указанному номеру может определить какому мобильному провайдеру нужно перевести средства. В общем выполнить подготовительные проверки.

4. Начинаем большую составную транзакцию - "begin tran" (вообще возможны разные варианты, предполагаю возможне такой вариант):
[начало транзакции]
- Банк формирует операцию, например, типа в электронном журнале, что с такого-то счета будет списаны средства на перевод на другой счет - записывает данные о проводке в таблицу, с фиксацией даты и времени.
- В таблице в которой хранится баланс средств исходного счета вычесть сумму перевода (прочитать что было, вычесть и обновить - записать на то что стало). Проверить, что не ушли в минус.
- в таблице, которая соответствует счету получателя - прибавить сумму (прочитать что было, прибавить, обновить - записать). проверить что счет не заблокирован и на него можно перевести средства.
- возможно в каких-то дополнительных таблицах пометить записать в таблице "журнал провдок" или в таблице логов, что операция проведена успешно в такое-то время и дату. и т.п.
[Конец транзакции]
Если на любом шаге что-то пошло не так, то откатить транзакцию - т.е либо все изменения выполнены успешно, либо ни одно изменение не выполнено.
Если все прошло ок, то,  завершить транзакцию.

5. Результаты отправить пользователю CMC. Но, это уже не входит в трназакцию общую.

---

2.1.* Какие действия должны произойти, если пополнение счёта телефона происходило бы через автоплатёж?

Приведите ответ в свободной форме.

Примерно тоже самое, только:

Если автоплатеж привязана к дате месяца, то, платешь инициирует сам банк.
Если автоплатеж привязан к порогу баланса, то, банк должен получать как-то информацию, от мобильного оператора, когда уровень средств снизится и нужно будет провести оплату.

----

---

## Задание 3. SQL vs NoSQL

---

3.1. Напишите пять преимуществ SQL-систем по отношению к NoSQL.

### Ответ

1. ACID
А - атомарность - т.е. можно выполнять транзакции, и откатывать сложные составные транзакции из нескольких операций. 
С - согласованность данных. Т.е. можно обеспечить что все данные согласованы, можно настраивать констрейны, огранчиения, которые будут обеспечивать целостность данных. Плюс транзакции обеспечивают целостность данных.
I - изоляцию. Можно гибко настраивать уровень изоляци итранзакций. Например если даже один начал читать данные, то, другой пользователь не сможет уже поменять данные, пока не закончится чтение. Или если один начал менять данные, другой не сможет даже читать. Но, есть варианты, когда можно выбрать другой уровень изоляции, например:
Один начал читать - читает одни данные в psql.
Другой изменил, но, в PSQL данные как бы скопировались в новое место и изменились там, все новые подключения будут видеть уже новые данные, а старое которое начало читать -пока еще видит старые данные из другого места в памяти. Это уменьшает блокировки и повышает скорость, но, есть риск несогласованости данных.
D - можно сказать - доступность можно восстановить данные из бэкапов на момент сбоя, имя: прошлый бэкап и уцелевшие данные в лог файле БД. 

Плю можно иметь нормализацию данных в БД, когда все данные будут разбиты на элементарные, будут размещены в разных таблицах и будет настроена связь данных между ними, настроены констрейны, индексы и т.п.

---

3.1.* Какие, на ваш взгляд, преимущества у NewSQL систем перед SQL и NoSQL.

Приведите ответ в свободной форме.

### Ответ

NewSQL (англ. новый SQL) — класс реляционных СУБД, возникших на рубеже 2000-х и 2010-х годов, стремящихся совместить в себе преимущества NoSQL и транзакционные требования классических систем управления базами данны

---

---

## Задание 4. Кластеры

Необходимо производить большое количество вычислений при работе с огромным количеством данных, под эту задачу выделено 1000 машин.

На основе какого критерия будете выбирать тип СУБД и какая модель распределённых вычислений здесь справится лучше всего и почему?

### Ответ

Вообще считаю исходных данных в задаче недостаточно. Где будут вычисления на клиенте? Или в самой БД? 1000 машин это видимо клиентских. И будет еще машина или машины с БД? Тип БД - зависит от данных и процессов и требований. 
Вероятно если делать одну БД, то, будет единая точка отказа и высокая нагрузка. Поэтому  нужно сделать кластер серверов с БД, с репликацией данных с одной БД на другую.
Или может нужно секционировать данные, разные данные разместить в разных БД на разных машинах - зависит от типа данных и уловий задачи. Но, как правило нужно всю БД дбулировать на других серверах. Если делать кластер возинкает вопрос - какие требования важнее - согласованность или быстроа внесение измеений и устойчивость к разделению. Если нужно что бы данные были бы согласованы на обоих серверах - нужно использовать синхронную репликацию. Но, это замедления в работе, и при разрыве связи или остяновятся процессы, или нужно пожертвовать целостностью данных на другой ноде и перейти в другой решим - разделение и данные на другой ноде будут отставать. Можно использоват асинхронную репликацию - на первой ноде сразу применяются изменения, на второй позже. Данные на другой ноде могут запазыдывать, и если связь порвется, то, вообще есть риск что часть изменений не придут на другие ноды.


Приведите ответ в свободной форме.

Задания,помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже разобраться в материале.